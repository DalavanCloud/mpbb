#!/bin/bash

# Note:
# This script is sourced by the its wrapper script.
# Do not execute this directly!


gather-archives-help() {
    echo "Gather unpublished and distributable archives of the built port."
}

gather-archives() {
    curl=/usr/bin/curl
    tclsh=${option_prefix}/bin/port-tclsh
    mkdir -p "${option_staging_dir}"

    archive_path=$("${option_prefix}/bin/port" -q location "${option_port}")
    archive_basename=$(basename "${archive_path}")

    if ! ${curl} -fIsL "${option_archive_site}/${option_port}/${archive_basename}" > /dev/null; then

        # check for distributability
        if "${tclsh}" "${option_workdir}/tools/port_binary_distributable.tcl" -v "${option_port}"; then
            echo "Staging archive for upload: ${archive_basename}"
            mkdir -p "${option_staging_dir}/${option_port}"
            cp "${archive_path}" "${option_staging_dir}/${option_port}/${archive_basename}":w
        fi
    fi
}
